- name: Run Docker Compose
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Start services using Docker Compose
      community.docker.docker_compose_v2:
        project_src: ".."
        state: present
        wait: false  # âœ… Correct way to run in detached mode
      async: 300  # Timeout after 5 minutes
      poll: 0
      register: compose_job

    - name: Debug async job ID  # Optional: Check if ansible_job_id exists
      debug:
        var: compose_job

    - name: Wait for Docker Compose to finish
      async_status:
        jid: "{{ compose_job.ansible_job_id }}"
      register: job_result
      until: job_result.finished
      retries: 30
      delay: 10
